"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),invariant=_interopDefault(require("invariant")),ReactDOM=require("react-dom"),ReactDOM__default=_interopDefault(ReactDOM),reactDomHtml=require("react-dom-html");require("react-dom/server");var getDisplayName=_interopDefault(require("react-display-name")),hoistNonReactStatic=_interopDefault(require("hoist-non-react-statics")),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},objectWithoutProperties=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),HTML_TAGS_HYDRATE_ATTR="data-react-dom-html-tags";function message(e){return"[react-dom-html-tags] "+e}function error(){}function forEachQuerySelectorAll(e,t,r){var n=e.querySelectorAll(t);if(n&&0!==n.length)for(var i=0,a=n.length;i<a;i++)r(n[i])}function getDomElementAttributeNames(e){if("function"==typeof e.getAttributeNames)return e.getAttributeNames();for(var t=e.attributes,r=t.length,n=new Array(r),i=0;i<r;i++)n[i]=t[i].name;return n}function reduceAttributes(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){var n=e[r];return t[r]=Array.isArray(n)?n.join(" "):n,t},t)}function reduceAttributesToString(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce(function(t,r){var n=e[r];return void 0===n?t:t+" "+r+'="'+n+'"'},"")}function renderForError(e,t){var r=t.children,n=reduceAttributesToString(objectWithoutProperties(t,["children"]),!0);return r?"<"+e+n+">"+r+"</"+e+">":"<"+e+n+" />"}var HEAD_TAG_NAMES={BASE:"base",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",TEMPLATE:"template"},HTML_CHILD_TAG_NAMES={BODY:"body",HEAD:"head",APP:"app"},TAG_NAMES=_extends({HTML:"html"},HTML_CHILD_TAG_NAMES,HEAD_TAG_NAMES),ATTRIBUTE_KEY_NAMES={HTML:"htmlAttributes",HEAD:"headAttributes",BODY:"bodyAttributes",APP:"appAttributes"},ATTRIBUTE_KEYS=Object.keys(ATTRIBUTE_KEY_NAMES).map(function(e){return ATTRIBUTE_KEY_NAMES[e]}),ELEMENT_ATTRIBUTE_TUPLES=[[TAG_NAMES.HTML,ATTRIBUTE_KEY_NAMES.HTML],[TAG_NAMES.HEAD,ATTRIBUTE_KEY_NAMES.HEAD],[TAG_NAMES.BODY,ATTRIBUTE_KEY_NAMES.BODY],[TAG_NAMES.APP,ATTRIBUTE_KEY_NAMES.APP]],TITLE_TEMPLATE="titleTemplate",NON_TAG_KEYS=ATTRIBUTE_KEYS.concat([TITLE_TEMPLATE]),HTML_CHILD_TAG_KEYS=Object.keys(HTML_CHILD_TAG_NAMES).map(function(e){return HTML_CHILD_TAG_NAMES[e]}),HEAD_TAG_KEYS=Object.keys(HEAD_TAG_NAMES).map(function(e){return HEAD_TAG_NAMES[e]}),TITLE_PLACEHOLDER="[title]",HtmlContext=function(){function e(t){classCallCheck(this,e),this._parent=t,this._children=[],this._forceUpdateCallback=null,this._nonDeterministicElements=[],this._ownComponentState=null,this._childrenComponentState=null,this._resolvedComponentState=null}return createClass(e,[{key:"isServerStringRender",value:function(){return this._parent.isServerStringRender()}},{key:"isPreLoaded",value:function(){return this._parent.isPreLoaded()}},{key:"isServerRender",value:function(){return this._parent.isServerRender()}},{key:"createChildContext",value:function(){return new e(this)}},{key:"hasChildren",value:function(){return 0!==this._children.length}},{key:"registerForceUpdateCallback",value:function(e){var t=this;if(e)return this._forceUpdateCallback=e,function(){t._forceUpdateCallback=null}}},{key:"unregisterForceUpdateCallback",value:function(){this._forceUpdateCallback&&(this._forceUpdateCallback=null)}},{key:"htmlComponentDidMount",value:function(e){return this._parent._children.push(this),this._clearProviderState(),this.registerForceUpdateCallback(e)}},{key:"htmlComponentWillUnmount",value:function(){var e=this._parent._children.indexOf(this);-1!==e&&(this._parent._children.splice(e,1),this._parent=null,this._clearProviderState(),this.unregisterForceUpdateCallback())}},{key:"forceComponentUpdate",value:function(e){return!!this._forceUpdateCallback&&(this._forceUpdateCallback(e()),!0)}},{key:"ignoreNonDeterministicHtml",value:function(){return this._parent.ignoreNonDeterministicHtml()}},{key:"setHtmlState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._ownComponentState=e,this._resolvedComponentState=null,t&&this._invalidateParentState(!0)}},{key:"_clearProviderState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._childrenComponentState=null,this._resolvedComponentState=null,this._invalidateParentState(e)}},{key:"notifyParentOnError",value:function(){this._parent&&this._parent.notifyParentOnError()}},{key:"resolveNonDeterministicErrors",value:function(e){this._isNonDeterministic()&&(this._clearProviderState(),this.forceComponentUpdate(e))||this._children.forEach(function(t){t.resolveNonDeterministicErrors(e)})}},{key:"_invalidateParentState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._parent&&this._parent._clearProviderState(e)}},{key:"resolveHtmlState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null===this._resolvedComponentState){var t=this._resolveChildHtmlState(e);this._resolvedComponentState=null===this._ownComponentState?t:this._mergeResolvedState(this._ownComponentState,t,!1)}return this._resolvedComponentState}},{key:"_resolveChildHtmlState",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null===this._childrenComponentState){var r=this._children.length;this._childrenComponentState=0===r?{}:1===r?this._children[0].resolveHtmlState(t):this._children.reduce(function(r,n){return e._mergeResolvedState(r,n.resolveHtmlState(t),t)},{})}return this._childrenComponentState}},{key:"_isNonDeterministic",value:function(){return 0!==this._nonDeterministicElements.length}},{key:"_mergeResolvedState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={};return this._mergeTitleTemplate(n,e,t,r),this._mergeAttributes(n,ELEMENT_ATTRIBUTE_TUPLES,e,t,r,["className"]),this._mergeElements(n,HEAD_TAG_KEYS,e,t,r),n}},{key:"_mergeTitleTemplate",value:function(e,t,r){var n=!!t[TITLE_TEMPLATE],i=!!r[TITLE_TEMPLATE];(n||i)&&(e[TITLE_TEMPLATE]=n?t[TITLE_TEMPLATE].slice():[],i&&Array.prototype.push.apply(e[TITLE_TEMPLATE],r[TITLE_TEMPLATE]))}},{key:"_mergeAttributes",value:function(e,t,r,n,i){var a=this,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];t.forEach(function(t){var s=slicedToArray(t,2),l=s[0],u=s[1];(r[u]||n[u])&&(e[u]=a._mergeAttribute(e,r[u],n[u],l,u,i,o))})}},{key:"_mergeElements",value:function(e,t,r,n,i){var a=this,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];t.forEach(function(t){(r[t]||n[t])&&(e[t]=a._mergeElement(e,r[t],n[t],t,i,o))})}},{key:"_mergeAttribute",value:function(e,t,r){var n=t&&Array.isArray(t.className),i=r&&Array.isArray(r.className);if(n||i){var a=t||{},o=a.className,s=objectWithoutProperties(a,["className"]),l=r||{},u=l.className,c=objectWithoutProperties(l,["className"]);return _extends({},this._mergeTag(s,c),{className:n&&i?u.reduce(function(e,t){return-1===e.indexOf(t)&&e.push(t),e},o.slice()):o&&o.slice()||u&&u.slice()})}return this._mergeTag(t,r)}},{key:"_mergeElement",value:function(e,t,r){return this._mergeTag(t,r)}},{key:"_mergeTag",value:function(e,t){return Object.assign({},e||{},t||{})}},{key:"resolveNonDeterministicChildren",value:function(e,t,r){var n=this,i=renderNonDeterministicNode(this._ownComponentState,e,t,r),a=[],o=0===this._children.length?{}:this._children.reduce(function(i,o){var s=o.resolveNonDeterministicChildren(e,t,r),l=slicedToArray(s,2),u=l[0],c=l[1];return u[t]&&(a=c.slice()),1===n._children.length?u:n._mergeResolvedState(i,u,!1)},{});return a.unshift(i),[this._mergeResolvedState(this._ownComponentState,o),a]}},{key:"_logNonDeterministicWarnings",value:function(){var e=this;this._nonDeterministicElements.forEach(function(t){var r=slicedToArray(t,3),n=r[0],i=r[1],a=r[2],o=[];e._children.forEach(function(e){var t=e.resolveNonDeterministicChildren(n,i,a),r=slicedToArray(t,2),s=(r[0],r[1]);o.push("\n"+s.join("  <-  "))}),e._logNonDeterministicWarning(n,a,o.join("\n"))})}},{key:"_flagNonDeterministic",value:function(e,t,r){this._nonDeterministicElements.push([e,t,r])}},{key:"_logNonDeterministicWarning",value:function(e,t,r){t.join(", "),t.length,t.length}}]),e}();function renderNonDeterministicNode(e,t,r,n){if(e[r]){var i=-1===NON_TAG_KEYS.indexOf(r)?e[t][r].props:e[r];return r===TITLE_TEMPLATE?Array.isArray(i)&&1===i.length?renderForError(t,{template:i[0](TITLE_PLACEHOLDER)}):renderForError(t,{template:"[Invalid template]"}):renderForError(t,n.reduce(function(e,t){return void 0!==i[t]&&(e[t]=i[t]),e},{}))}return"<>"}var REACT_PROP_NAMES={CHARSET:"charSet",HTTPEQUIV:"httpEquiv",ITEM_PROP:"itemProp",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",CANONICAL:"canonical",HREF:"href"};function resolveAttributes(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0!==Object.keys(e).length){var t=e.className,r=objectWithoutProperties(e,["className"]);return t?_extends({},r,{className:t.split(" ")}):r}}function assignAttributes(e,t,r,n){var i=resolveAttributes(r,n);return i?_extends({},e,defineProperty({},t,i)):e}function resolveHtml(e,t,r){var n=e.props,i=n.children,a=objectWithoutProperties(n,["children"]);return i&&React.Children.count(i)>0&&React.Children.forEach(i,function(e){t=resolveHtmlElements(e,t,r)}),assignAttributes(t,ATTRIBUTE_KEY_NAMES.HTML,a,r)}function resolveBody(e,t,r){var n=e.props,i=n.children,a=objectWithoutProperties(n,["children"]),o=React.Children.count(i);if(1===o)t=resolveApp(i,t,r);else if(0!==o)throw new Error("<body> is only permitted to have a single child, <app>.");return assignAttributes(t,ATTRIBUTE_KEY_NAMES.BODY,a,r)}function resolveApp(e,t,r){var n=e.props,i=n.children,a=objectWithoutProperties(n,["children"]);if(!r.permitAppChildren&&0!==React.Children.count(i))throw new Error("<app> does not support the use of children.");return assignAttributes(t,"appAttributes",a,r)}function isAttributeEqualTo(e,t,r){var n=e[t];return void 0!==n&&n.toLowerCase()===r}var LINK_KEY_ATTRIBUTES=[REACT_PROP_NAMES.REL,REACT_PROP_NAMES.ITEM_PROP,REACT_PROP_NAMES.HREF],META_KEY_ATTRIBUTES=[REACT_PROP_NAMES.NAME,REACT_PROP_NAMES.HTTPEQUIV,REACT_PROP_NAMES.PROPERTY,REACT_PROP_NAMES.ITEM_PROP];function getKeySuffix(e,t,r){for(var n="",i=0,a=t.length;i<a;i++){var o=t[i],s=e[o];s&&(n+=o+"="+s)}if(""===n)throw new Error(message("Html <head> contain invalid <"+r+"> tag, one of the primary props is required: "+t.join(", ")));return n}function getKey(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t?e+":"+(r?hashCode(t):t):e}function assignKey(e,t){if(TAG_NAMES.BASE===e)return getKey(e);if(TAG_NAMES.LINK===e)return getKey(e,isAttributeEqualTo(t,REACT_PROP_NAMES.REL,REACT_PROP_NAMES.CANONICAL)?REACT_PROP_NAMES.CANONICAL:getKeySuffix(t,LINK_KEY_ATTRIBUTES,e));if(TAG_NAMES.META===e)return getKey(e,void 0!==t[REACT_PROP_NAMES.CHARSET]?REACT_PROP_NAMES.CHARSET:getKeySuffix(t,META_KEY_ATTRIBUTES,e));if(TAG_NAMES.TEMPLATE===e){var r=t.id;return"string"!=typeof r||r.length,getKey(e,r||"")}throw new Error(message('"<'+e+'>" tag is not a valid "<head>" child element. Valid child tag names are: "'+HEAD_TAG_KEYS.join('", "')+'".'))}function hashCode(e){for(var t=0,r=0,n=e.length;r<n;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t}function mapDangerouslySetToState(e,t,r){var n=r.props,i=(n.children,getKey(e,n.dangerouslySetInnerHTML.__html,!0));return assignState(e,t,i,React.cloneElement(r,{key:i}))}var SCRIPT=TAG_NAMES.SCRIPT;function assertPropOrDangerouslySet(e,t,r,n){if(void 0===r)throw new Error("<"+e+"> expects a 'dangerouslySetInnerHTML' or '"+t+"' prop.");if(n&&(void 0===r?"undefined":_typeof(r))!==n)throw new Error("<"+e+"> expects '"+t+"' to be a '"+n+"' type.")}function isDangerouslySetDefined(e){return void 0!==e.props.dangerouslySetInnerHTML}function mapScriptToState(e,t){var r=e.props.src;if(isDangerouslySetDefined(e))return mapDangerouslySetToState(SCRIPT,t,e);assertPropOrDangerouslySet(SCRIPT,REACT_PROP_NAMES.SRC,r,"string");var n=getKey(SCRIPT,r);assignState(SCRIPT,t,n,React.cloneElement(e,{key:n}))}var STYLE=TAG_NAMES.STYLE;function mapStyleToState(e,t){var r=e.props,n=r.children,i=objectWithoutProperties(r,["children"]);if(isDangerouslySetDefined(e))return mapDangerouslySetToState(STYLE,t,e);assertPropOrDangerouslySet(STYLE,"children",n,"string");var a=getKey(STYLE,n,!0);return assignState(STYLE,t,a,React.createElement(STYLE,_extends({},i,{key:a,dangerouslySetInnerHTML:{__html:n.trim()}})))}var NOSCRIPT=TAG_NAMES.NOSCRIPT;function mapNoScriptToState(e,t,r){var n=e.props.children;if(isDangerouslySetDefined(e))return mapDangerouslySetToState(NOSCRIPT,t,e);if(assertPropOrDangerouslySet(NOSCRIPT,"children",n),"string"!=typeof n){r.isServerRender;var i={},a=[];React.Children.forEach(n,function(e){var t=e.type;if(t===STYLE)return a.push(mapStyleToState(e,i));if(t===TAG_NAMES.LINK||t===TAG_NAMES.META)return a.push(mapElementToState(t,e,i));throw new Error(message("Element <"+t+"> is not permitted to be a child of <"+NOSCRIPT+"> when in the document <"+TAG_NAMES.HEAD+">."))});var o="",s=a.reduce(function(e,t){return o+=t,e.push(i[t]),e},[]);return assignState(NOSCRIPT,t,o,React.createElement(NOSCRIPT,{key:o},s))}var l=e.props,u=l.children,c=objectWithoutProperties(l,["children"]),d=getKey(NOSCRIPT,u,!0);assignState(NOSCRIPT,t,d,React.createElement(NOSCRIPT,_extends({},c,{key:d,dangerouslySetInnerHTML:{__html:u}})))}var TITLE=TAG_NAMES.TITLE;function mapTitleToState(e,t,r){var n=e.props,i=n.children,a=n.template,o=objectWithoutProperties(n,["children","template"]);if("function"==typeof a)r[TITLE_TEMPLATE]=[a];else if(void 0!==a)throw new Error(message("title template expects a function."));assignState(TITLE,t,TITLE,React.createElement(TITLE,_extends({},o,{key:i}),i))}function assignState(e,t,r,n){return t[r]=n,r}function mapElementToState(e,t,r){var n=assignKey(e,t.props);return assignState(e,r,n,React.cloneElement(t,{key:n}))}function resolveHead(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.props,a=i.children,o=objectWithoutProperties(i,["children"]);return!n&&Object.keys(o).length,a&&React.Children.forEach(a,function(e){var n=e.type,i=t[n]=t[n]||{};n===TITLE?mapTitleToState(e,i,t):n===STYLE?mapStyleToState(e,i):n===SCRIPT?mapScriptToState(e,i):n===NOSCRIPT?mapNoScriptToState(e,i,r):mapElementToState(n,e,i)}),assignAttributes(t,ATTRIBUTE_KEY_NAMES.HEAD,o,r)}function resolveHtmlElement(e,t,r){var n=React.Children.only(e),i=n.type;if(i===TAG_NAMES.HTML)return resolveHtml(n,t,r);if(i===TAG_NAMES.HEAD)return resolveHead(n,t,r);if(i===TAG_NAMES.BODY)return resolveBody(n,t,r);if(i===TAG_NAMES.APP)return resolveApp(n,t,r);throw new Error(message('Invalid html markup, tag "'+i+'" is not supported.'))}function resolveHtmlElements(e,t,r){return e&&0!==React.Children.count(e)?resolveHtmlElement(e,t,r):{}}function mapHtmlToState(e,t){return resolveHtmlElement(e,{},t)}function mapHeadElementToState(e,t){return resolveHead(e,{},t,!1)}var DIV="div",DATA_REACT_ROOT_ATTR="data-reactroot",defaultOptions={isHydrating:!1,isServerRender:!1,isStreamRender:!1},defaultPriorityComponentKeys=["meta:charSet","meta:httpEquiv=X-UA-Compatible","meta:name=viewport",TAG_NAMES.TITLE],HtmlMetadata=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,e);var r=Object.assign({},defaultOptions,t),n=r.isHydrating,i=r.isServerRender,a=r.isStreamRender;this._htmlContext=new HtmlContext(this),this._priorityComponentKeys=defaultPriorityComponentKeys,this._externalHeadElementSelectors=["["+HTML_TAGS_HYDRATE_ATTR+"]"],this._onChangeSubscribers=[],this._isServerRender=i,this._isHydratingClient=!i&&n,this._isServerStreamRender=i&&a,this._isStaticServerRender=!1,this._isPreloaded=!1,this._headFragment=null,this._isHtmlProviderMounted=!1,this._isHeadMounted=!1,this._ignoreNonDeterministicHtml=!1,this._isNonDeterministic=!1,this._appliedAttributes={},this._appContainer=null,this._nonDeterministicUpdateCounter=0,this._htmlState=null,this._headComponentCache=null,this._attributeCache=null,this._serializedState=null}return createClass(e,null,[{key:"createForClientRender",value:function(){return new e}},{key:"createForClientHydrate",value:function(){return new e({isHydrating:!0})}},{key:"createForServerStreamRender",value:function(){return new e({isServerRender:!0,isStreamRender:!0})}},{key:"createForServerStringRender",value:function(){return new e({isServerRender:!0})}}]),createClass(e,[{key:"getRootContext",value:function(){return this._htmlContext}},{key:"appendExternalHeadSelectors",value:function(e){e&&0!==e.length&&(Array.isArray(e)?Array.prototype.push.apply(this._externalHeadElementSelectors,e):this._externalHeadElementSelectors.push(e))}},{key:"getExternalHeadSelectors",value:function(){return this._externalHeadElementSelectors}},{key:"_clearProviderState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._htmlState=null,this._headComponentCache=null,this._attributeCache=null,e&&0===this._nonDeterministicUpdateCounter&&this.notifySubscribers()}},{key:"startComponentLifecycle",value:function(){!this._isPreloaded&&this.getRootContext().hasChildren()&&(this._isPreloaded=!0)}},{key:"isPreLoaded",value:function(){return this._isPreloaded}},{key:"isHtmlProviderMounted",value:function(){return this._isHtmlProviderMounted}},{key:"isHeadMounted",value:function(){return this._isHeadMounted}},{key:"headDidMount",value:function(e){this._isHeadMounted||(this._isHeadMounted=!0),this.notifySubscribers(e)}},{key:"htmlProviderDidMount",value:function(e){if(!this._isHtmlProviderMounted)return this._isHtmlProviderMounted=!0,this._htmlContext.registerForceUpdateCallback(e)}},{key:"htmlProviderWillUnmount",value:function(){this._isHtmlProviderMounted&&(this._isHtmlProviderMounted=!1,this._htmlContext.unregisterForceUpdateCallback())}},{key:"isNonDeterministic",value:function(){return!0===this._isNonDeterministic}},{key:"notifyParentOnError",value:function(){this.ignoreNonDeterministicHtml()||this.isNonDeterministic()||(this._isNonDeterministic=!0)}},{key:"resolveNonDeterministicErrors",value:function(){}},{key:"setIgnoreNonDeterministicHtml",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._ignoreNonDeterministicHtml=e}},{key:"ignoreNonDeterministicHtml",value:function(){return!0===this._ignoreNonDeterministicHtml}},{key:"appendHtmlState",value:function(e){var t=this.getRootContext().createChildContext();t.htmlComponentDidMount(),t.setHtmlState(e)}},{key:"appendHead",value:function(e){this.getRootContext().setHtmlState(mapHeadElementToState(e))}},{key:"_getInternalState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.isHtmlProviderMounted();return this._htmlState||(this._htmlState=this._htmlContext.resolveHtmlState(e)),this._htmlState}},{key:"serializeState",value:function(e){invariant(this.isServerRender(),message("`serializeState` is not supported on the client.")),invariant("function"==typeof e,message("`serializeState()` requires a 'renderToString' function argument."));var t=this.getServerAttributes(),r=t.headAttributes,n=objectWithoutProperties(t,["headAttributes"]);return _extends({},n,{head:e(React.createElement(TAG_NAMES.HEAD,r,React.createElement(this._headFragment,this.getHeadComponents())))})}},{key:"useSerializedState",value:function(e){invariant(this.isServerRender(),message("`useSerializedState` is not supported on the client.")),this._isPreloaded=!0,this._serializedState=e}},{key:"_hasSerializedState",value:function(){return null!==this._serializedState}},{key:"_getSerializedState",value:function(){return this._serializedState}},{key:"getHeadComponents",value:function(){if(!this._headComponentCache){var e=this._getInternalState();this._headComponentCache=reduceStateToComponents(HEAD_TAG_KEYS,e,this._priorityComponentKeys)}return this._headComponentCache}},{key:"getServerAttributes",value:function(e,t){var r=reactDomHtml.getAppContainerProps(e,t),n=r.tagName,i=r.id;return _extends({appTagName:n},this.getAttributes({id:i}))}},{key:"getAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._attributeCache){var t=this._getInternalState();this._attributeCache=ATTRIBUTE_KEYS.reduce(function(r,n){var i=t[n],a=n===ATTRIBUTE_KEY_NAMES.APP&&null!==e;return(a||void 0!==i)&&(r[n]=reduceAttributes(i,a?e:{})),r},{})}return this._attributeCache}},{key:"setAppContainer",value:function(e){this._appContainer=e}},{key:"_getDomAttributesToRemove",value:function(e,t){if(void 0===this._appliedAttributes[e]){this._appliedAttributes[e]=getDomElementAttributeNames(t);var r=this._appliedAttributes[e].indexOf(DATA_REACT_ROOT_ATTR);if(-1!==r&&this._appliedAttributes[e].splice(r,1),e===TAG_NAMES.APP){var n=this._appliedAttributes[e].indexOf("id");-1!==n&&this._appliedAttributes[e].splice(n,1)}}return this._appliedAttributes[e].slice()}},{key:"_setDomAttributesFor",value:function(e,t){this._appliedAttributes[e]=t}},{key:"renderAttributes",value:function(){var e=this;if(this.isServerRender())throw new Error(message("can not render attributes on server"));var t=this.getAttributes();ELEMENT_ATTRIBUTE_TUPLES.forEach(function(r){var n=slicedToArray(r,2),i=n[0],a=n[1],o=t[a],s=i===TAG_NAMES.APP?e._appContainer:document.querySelector(i),l=e._getDomAttributesToRemove(i,s);if(void 0!==o){var u=document.createElement(DIV);ReactDOM.render(React.createElement(DIV,o),u,function(){var t=u.childNodes[0],r=getDomElementAttributeNames(t);r.forEach(function(e){var r=t.getAttribute(e);s.hasAttribute(e)?s.getAttribute(e)!==r&&s.setAttribute(e,r):s.setAttribute(e,r);var n=l.indexOf(e);-1!==n&&l.splice(n,1)}),e._setDomAttributesFor(i,r),ReactDOM.unmountComponentAtNode(u),"function"==typeof u.remove&&u.remove(),removeAttributesFromDomNode(l,s)})}else removeAttributesFromDomNode(l,s)})}},{key:"notifySubscribers",value:function(e){var t=0,r=this._onChangeSubscribers.length;this._onChangeSubscribers.forEach(function(n){return n(function(){++t===r&&"function"==typeof e&&e()})})}},{key:"onChange",value:function(e){var t=this;return t._onChangeSubscribers.push(e),function(){var r=t._onChangeSubscribers.indexOf(e);r>-1&&t._onChangeSubscribers.splice(r,1)}}},{key:"setPriorityComponentKeys",value:function(e){this._priorityComponentKeys=e}},{key:"setHeadFragment",value:function(e){this._headFragment=e}},{key:"setRenderedHeadFragment",value:function(e){this._renderedHeadFragment=e}},{key:"didRenderCorrectHeadFragment",value:function(){return!this.isHydratingClient()||this._renderedHeadFragment===this._headFragment}},{key:"isClientRender",value:function(){return!this._isServerRender}},{key:"isHydratingClient",value:function(){return this.isClientRender()&&!0===this._isHydratingClient}},{key:"isRenderingClient",value:function(){return this.isClientRender()&&!1===this._isHydratingClient}},{key:"isServerRender",value:function(){return this._isServerRender}},{key:"isServerStreamRender",value:function(){return this.isServerRender()&&this._isServerStreamRender}},{key:"isServerStringRender",value:function(){return this.isServerRender()&&!this._isServerStreamRender}},{key:"setStaticServerRender",value:function(e){this._isStaticServerRender=e}},{key:"isServerStaticRender",value:function(){return this.isServerRender()&&this._isStaticServerRender}}]),e}();function removeAttributesFromDomNode(e,t){null!==t&&e.forEach(function(e){t.hasAttribute(e)&&t.removeAttribute(e)})}var TITLE$1=TAG_NAMES.TITLE;function reduceStateToComponents(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n={},i=e.reduce(function(e,i){var a=t[i];if(void 0===a)return e;if(i===TITLE$1){if(t[TITLE_TEMPLATE]||t[TITLE$1]){var o=t[TITLE$1]&&t[TITLE$1].title?t[TITLE$1].title.props:{children:""},s=o.children,l=objectWithoutProperties(o,["children"]),u=t.titleTemplate&&t.titleTemplate.length>0?t.titleTemplate.reduceRight(function(e,t){return t(e)},s):s,c=React.createElement(TITLE$1,_extends({key:u},l),u);-1!==r.indexOf(TITLE$1)?n[TITLE$1]=c:e[i]=[c]}return e}var d=Object.keys(a).reduce(function(e,t){return-1!==r.indexOf(t)?n[t]=a[t]:e.push(a[t]),e},[]);return 0!==d.length&&(e[i]=d),e},{}),a=!1,o=r.reduce(function(e,t){var r=n[t];return void 0!==r&&(a||(a=!0),e.push(r)),e},[]);return a&&(i.priority=o),i}var _createContext=React.createContext(HtmlMetadata.createForClientRender().getRootContext()),Provider=_createContext.Provider,Consumer=_createContext.Consumer;function createHtmlHOC(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=t=function(t){function r(t,n){classCallCheck(this,r);var i=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n)),a=(t.children,t.htmlContext),o=objectWithoutProperties(t,["children","htmlContext"]);if(!a)throw new Error(message("Missing `htmlContext`, are you missing a parent HtmlProvider?"));return i._unsubscribe=null,i.state={derivedMetadata:null,htmlContext:a.createChildContext(),mapOptions:{isServerRender:a.isServerRender()}},a.isServerStringRender()&&!a.isPreLoaded()&&(i.state.htmlContext.htmlComponentDidMount(),i._setHtmlContextState(e(o,i.state.mapOptions),!1)),i}return inherits(r,t),createClass(r,null,[{key:"getDerivedStateFromProps",value:function(t,r){t.children,t.htmlContext;var n=objectWithoutProperties(t,["children","htmlContext"]),i=e(n,r.mapOptions);return i?{derivedMetadata:i}:null}}]),createClass(r,[{key:"componentDidMount",value:function(){var e=this,t=this.state,r=t.htmlContext,n=t.derivedMetadata;this._unsubscribe=r.htmlComponentDidMount(function(t){e.forceUpdate(t)}),this._setHtmlContextState(n,!1)}},{key:"componentDidUpdate",value:function(){var e=this.state.derivedMetadata;this._setHtmlContextState(e,!0)}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=null);var e=this.state.htmlContext;this._setHtmlContextState(null,!0),e.htmlComponentWillUnmount()}},{key:"render",value:function(){return React__default.createElement(Provider,{value:this.state.htmlContext},this.props.children)}},{key:"_setHtmlContextState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.state.htmlContext.setHtmlState(e,t)}}]),r}(React.Component),t.defaultProps=n,r}var HTML=TAG_NAMES.HTML,BODY=TAG_NAMES.BODY,APP=TAG_NAMES.APP,VALID_BODY_CHILDREN=[APP];function findAppElement(e){var t=e.children,r=null;return React.Children.forEach(t,function(e){r||null===e||(e.type===BODY?r=findAppElement(e.props,VALID_BODY_CHILDREN):e.type===APP&&(r=e))}),r}function findApplicationChildren(e){var t=findAppElement(e,HTML_CHILD_TAG_KEYS);if(!t)throw new Error(message("<Html> requires an <app> element. It can be an immediate child, or a child of <body>."));var r=t.props.children;if(!r||0===React.Children.count(r))throw new Error(message("<Html> requires the <app> element to have children."));return r}var HtmlHOC=createHtmlHOC(function(e,t){return mapHtmlToState(e.htmlElement,_extends({},t,{permitAppChildren:!0}))});function Html(e){var t=findApplicationChildren(e),r=e.children,n=objectWithoutProperties(e,["children"]),i=React__default.createElement(HTML,n,r);return React__default.createElement(Consumer,null,function(e){return React__default.createElement(HtmlHOC,{htmlElement:i,htmlContext:e},t||null)})}function HeadFragment(e){var t=e.priority,r=e.title,n=e.base,i=e.meta,a=e.link,o=e.style,s=e.script,l=e.noscript,u=e.template;return React__default.createElement(React__default.Fragment,null,t,r,n,i,o,a,u,l,s)}var HeadContainer=function(e){function t(e,r){classCallCheck(this,t);var n=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n._unsubscribe=null,n.state={htmlMetadata:e.metadata,lastUpdated:0},n}return inherits(t,e),createClass(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.htmlMetadata,r=void 0;if(this.props.clearExistingChildren){var n=t.getExternalHeadSelectors(),i=n.map(function(e){return":not("+e+")"}),a=document.querySelector("head");forEachQuerySelectorAll(a,i.join(""),function(e){a.removeChild(e)}),r=function(){forEachQuerySelectorAll(a,n.join(", "),function(e){a.appendChild(e)})}}e._unsubscribe=t.onChange(function(r){t.renderAttributes(),e.setState({lastUpdated:Date.now()},r)}),t.headDidMount(r)}},{key:"componentDidUpdate",value:function(){var e=this.state.htmlMetadata;e.isNonDeterministic()&&e.resolveNonDeterministicErrors()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=null)}},{key:"render",value:function(){return this.props.children(this.state.htmlMetadata.getHeadComponents())}}]),t}(React__default.Component);HeadContainer.defaultProps={clearExistingChildren:!1};var BrowserHeadPortal=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"render",value:function(){return ReactDOM__default.createPortal(this.props.children,document.querySelector("head"))}}]),t}(React.Component),HtmlProvider=function(e){function t(e,r){classCallCheck(this,t);var n=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),i=e.metadata,a=e.headFragment,o=e.headPortal,s=e.suppressNonDeterministicWarnings,l=e.headComponentPriorityKeys,u=i||HtmlMetadata.createForClientRender();return u.setHeadFragment(a),l&&u.setPriorityComponentKeys(l),u.startComponentLifecycle(),s&&u.setIgnoreNonDeterministicHtml(!0),n._unsubscribe=null,n.state={htmlMetadata:u,htmlContext:u.getRootContext(),headPortal:o||!u.isServerRender()&&!u.isHydratingClient()?BrowserHeadPortal:null},n}return inherits(t,e),createClass(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state,r=t.htmlMetadata;null===t.headPortal&&r.headDidMount(),this._unsubscribe=r.htmlProviderDidMount(function(){return e.forceUpdate()})}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=null),this.state.htmlMetadata.htmlProviderWillUnmount()}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.headFragment,n=this.state,i=n.htmlContext,a=n.htmlMetadata,o=n.headPortal;return React__default.createElement(Provider,{value:i},React.Children.only(t),o&&React__default.createElement(HeadContainer,{metadata:a,clearExistingChildren:!0},function(e){return React__default.createElement(o,null,React__default.createElement(r,e))}))}}]),t}(React.Component);function withHtml(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.componentDisplayName,n=t.displayNamePrefix,i=function(t,r){return mapHtmlToState(e(t),_extends({},r,{permitAppChildren:!1}))};return function(e){var t=r||getDisplayName(e),a=createHtmlHOC(i,e&&e.defaultProps),o=function(t){var r=t.children,n=objectWithoutProperties(t,["children"]),i=null===e?null:void 0!==r?React__default.createElement(e,n,r):React__default.createElement(e,n);return React__default.createElement(Consumer,null,function(e){return React__default.createElement(a,_extends({},n,{htmlContext:e}),i)})};return o.appendHtmlMetadata=function(e,t){e.appendHtmlState(i(t))},o.displayName=n+"("+t+")",null===e?o:(o.WrappedComponent=e,hoistNonReactStatic(o,e))}}function createHeadChildren(e,t){var r=e.type||{},n="function"==typeof r.getHeadFragment?r.getHeadFragment():r===HtmlProvider?e.props.headFragment:HeadFragment;return React.createElement(HeadContainer,{metadata:t},n)}function withHtmlProvider(e,t){if(React.isValidElement(e))return React__default.createElement(HtmlProvider,{metadata:t},e);if("function"==typeof e)return e(t);throw new Error(message("Root element must be React element or function that returns a React element"))}function removeHeadElements(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=[],i=[t];return"string"==typeof r?i.push(r):Array.isArray(r)&&0!==r.length&&[].push.apply(i,r),forEachQuerySelectorAll(e,i.join(", "),function(t){n.push(e.removeChild(t))}),n}function hydrateHtml(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=takeAttributeSnapshot();var n=document.querySelector("head"),i=HtmlMetadata.createForClientHydrate(),a=r.container,o=r.callback,s=r.externalHeadElementSelectors,l=r.hydratedHeadElementSelectors;return prepareForRender(i,e,a,function(e,r){var a=removeHeadElements(n,"["+HTML_TAGS_HYDRATE_ATTR+"='false']",s);reactDomHtml.hydrateHtml(e,r,function(){var r=removeHeadElements(n,"["+HTML_TAGS_HYDRATE_ATTR+"='true']",l);reactDomHtml.hydrateHtml(createHeadChildren(e,i),n,function(){r.length>0&&r.forEach(function(e){return n.appendChild(e)}),a.length>0&&a.forEach(function(e){return n.appendChild(e)});var e=takeAttributeSnapshot();compareSnapshots(t,e),o&&o()})})})}function renderHtml(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=HtmlMetadata.createForClientRender(),n=t.container,i=t.callback,a=t.externalHeadElementSelectors;return a&&r.appendExternalHeadSelectors(a),prepareForRender(r,e,n,function(e,t){reactDomHtml.renderHtml(e,t,i)})}function prepareForRender(e,t,r,n){var i=withHtmlProvider(t,e),a=r||document.querySelector(reactDomHtml.getAppContainerProps(React.isValidElement(t)?t:i).querySelector);return e.setAppContainer(a),n(i,a),function(){e.setAppContainer(null)}}function compareSnapshots(e,t){e.htmlAttributes!==t.htmlAttributes&&error("Warning: The hydrated html attributes do not match. Server: `"+e.htmlAttributes+"` Client: `"+t.htmlAttributes+"`."),e.bodyAttributes!==t.bodyAttributes&&error("Warning: The hydrated body attributes do not match. Server: `"+e.bodyAttributes+"` Client: `"+t.bodyAttributes+"`.")}function takeAttributeSnapshot(){return{htmlAttributes:snapshotAttributes(document.querySelector("html")),bodyAttributes:snapshotAttributes(document.querySelector("body"))}}HtmlProvider.defaultProps={headPortal:null,suppressNonDeterministicWarnings:!1,headFragment:HeadFragment};var ATTRIBUTE_NAME_MAP={classname:"class",className:"class"};function snapshotAttributes(e){if(!e||!e.hasAttributes())return"";for(var t={},r=e.attributes,n=r.length-1;n>=0;n--)t[r[n].name]=r[n].value;return Object.keys(t).sort().reduce(function(e,r){var n=t[r];return void 0!==n&&e.push((ATTRIBUTE_NAME_MAP[r]||r)+'="'+n+'"'),e},[]).join(" ")}exports.Html=Html,exports.withHtml=withHtml,exports.renderHtml=renderHtml,exports.hydrateHtml=hydrateHtml,exports.HtmlProvider=HtmlProvider,exports.HtmlMetadata=HtmlMetadata,exports.withHtmlProvider=withHtmlProvider,exports.createHeadChildren=createHeadChildren,exports.default=Html;
